{% extends 'base.html' %}

{% load static %}

{% block content %}
{% if error %}
<div class="alert alert-danger container-fluid alert-dismissible fade show" role="alert">
  <strong>{{error}}</strong>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
<!-- for detail -->

<div class="container" style="margin-top: 115px;">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card">
        <div class="row ">
          <div class="col-md-6">
            <div class="images p-3">
              <div class="text-center p-4"> {% if item.item_image1 %}<img id="main-image" src="{{item.item_image1}}" width="100%" /> {% elif item.item_image2 %} <img id="main-image" src="{{item.item_image2}}" width="250" /> {% elif item.item_image3 %} <img id="main-image" src="{{item.item_image3}}" width="250"/> {% endif %} </div>
              <div class="thumbnail text-center"> {% if item.item_image2 %} <img onclick="change_image(this)" src="{{item.item_image2}}" width="70"> {% endif %} {% if item.item_image3 %} <img onclick="change_image(this)" src="{{item.item_image3}}" width="70"> {% endif %} {% if item.item_image1 %} <img onclick="change_image(this)" src="{{item.item_image1}}" width="70"> {% endif %}
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="product p-4">
              <div class="mt-4 mb-3"> <span class="text-uppercase text-muted brand">
                  <h6>Seller: <a href="{% url 'users:profile' item.shop_id%}"
                      style="text-decoration: none;">{{item.shop_name}}</a></h6>
                </span>
                <h5 class="text-uppercase">{{item.item_name}}</h5>
                <p>Kind: {{item.kind}}</p>
                <div class="price d-flex flex-row align-items-center">
                  
                  <span style="color: green;" class="act-price">{% if item.price != 0 %}{{item.price}}MMK{% else%}စျေးအပြောင်းအလဲရှိနိုင်{% endif %} </span>
                  
                  
                </div>
              </div>
              <p class="about">{{item.details}}</p>
              <div class="cart mt-4 align-items-center"> <a href="{{item.item_link}}"><button class="btn btn-primary text-uppercase"
                >Buy</button></a> <i
                  class="fa fa-heart text-muted"></i>
              {%if request.user.is_authenticated and request.user.is_verified%}
               <i class="fa fa-share-alt text-muted"></i> <a
                  href="{% url 'users:save' item.id%}"><button class="btn btn-primary text-uppercase">Save for
                    later</button></a>
              </div>
              {% else %}
                <i class="fa fa-share-alt text-muted"></i>
                <button type="button" class="btn btn-primary text-uppercase" data-bs-toggle="popover" data-bs-placement="top"
                  data-bs-content="You have to login/verify first.">
                  Save for later
                </button>
              {% endif %}
              {% if request.user.pk == item.shop_id %}
              <br>
              <a href="{% url 'items:delete' item.id%}">
              <button type="button" class="btn btn-danger text-uppercase">
                  Delete Post
                </button></a>
              {% endif %}
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="row d-flex justify-content-center">
    <div class="col-md-10">
      <div class="justify-content-left">
        <p style="color: red;">{{error}}</p>
        {%if request.user.is_authenticated  and request.user.is_verified%}
        <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal"
          style="margin: 20px;">Comment</button>
        {% else %}
        <button type="button" class="btn btn-secondary" data-bs-toggle="popover" data-bs-placement="top"
                  data-bs-content="You have to login/verify  first.">
                  Comment
                </button>
        {% endif %}
      </div>
      <br>
      <div class="modal" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">comment</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form method="post" action="{% url 'items:comment'%}" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <br>
                <div class="form-group">
                  <textarea name="comment" placeholder="Type your comment." class="form-control"
                    id="exampleFormControlTextarea1" rows="3"></textarea>
                </div>
                <br>
                <input type="hidden" name="card" value="{{item.id}}">


                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancle</button>
                <button type="submit" class="btn btn-primary">Post</button>
            </div>

            </form>

          </div>

        </div>
      </div>
    </div>
  </div>

  <br>
  <div class="row d-flex justify-content-center">
    <div class="col-md-10">
      <div class="card-body p-10">
        {% for comment in comments %}
        <div class="card mb-4">
          <div class="card-body">
            <p>{{ comment.comment }}</p>

            <div class="d-flex justify-content-between">
              <div class="d-flex flex-row align-items-center">
                <p class="small mb-0 ms-2">User: {{ comment.user.username }}</p>
              </div>
              <div class="d-flex flex-row align-items-center">
                <p class="small text-muted mb-0">{{ comment.commented_at }}</p>
                <i class="far fa-thumbs-up mx-2 fa-xs text-black" style="margin-top: -0.16rem;"></i>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <p>No comments available.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
</div>

{% endblock content %}